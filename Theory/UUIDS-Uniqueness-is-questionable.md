# Оглавление
1. [Суть коллизии](#FirstBullit)
2. [Частный случай коллизии](#SecondBullit)
3. [Решаем в общем виде](#Solution)

## Суть коллизии <a name="FirstBullit"></a>
UUID (поколения 4) - это псевдослучайное 32-байтное слово, в котором 6 бит отведены на хозяйственные расходы.
То есть, существует $2^{122} = 5,3 \cdot 10^{36}$ уникальных вариантов.
При создании нового UUID есть вероятность совпадения с ранее созданным. Задача - найти формулу для вычисления минимального количества уникальных UUID для соблюдения заданной надёжности.
Бизнес-контекст: при записи событий в аудит для долгосрочного хранения каждой строке присваивается UUID, который на всей глубине хранения должен оставаться уникальным
Математической записью это выглядит так:

```math
$
\forall n , P (n \in \mathbb{N}, P \in \mathbb{Q}):
\exists x , x \in \mathbb{N}, x \le n \implies    
\frac{n!}{(n-x)! \cdot n^x} \ge P
$
```

## Частный случай коллизии<a name="SecondBullit"></a>
---
В группе из 23 человек у двоих день рождения совпадает с вероятностью 50%.

> [!NOTE]
> Уникальность исследования плохо подтверждается, будем считать эту статью - компиляцией накопленного опыта без претензий на оригинальность.


## Решаем в общем виде<a name="Solution"></a>
Упростим
$\frac{n!}{(n-x)! \cdot n^x} \ge P$

С помощью формулы Стирлинга: $n{!}={\sqrt{2 \cdot \pi \cdot n} \cdot n^n \cdot e^{-n}}$

$\frac {\sqrt{2 \cdot \pi \cdot n} \cdot n^n \cdot e^{-n}} {\sqrt{2 \cdot \pi \cdot (n-x)} \cdot (n-x)^{n-x} \cdot e^{x-n} \cdot n^x} \ge P$

Получаем

$\sqrt{\frac {n}{n-x}} \cdot \left(\frac{n}{n-x} \right)^{n-x} \cdot e^{-x} \ge P$

Или, чтоб было больше похоже на "второй замечательный предел"

$\sqrt{\frac {n}{n-x}} \cdot \frac {\left(1-\frac{x}{n} \right)^{x} }{\left(1-\frac{x}{n} \right)^{n}} \cdot e^{-x} \ge P$

$\sqrt{\frac {n}{n-x}} \cdot \frac {\left(1-\frac{x}{n} \right)^{x} }{e^{-x}} \cdot e^{-x} \ge P$

$\sqrt{\frac {n}{n-x}} \cdot  {\left(1-\frac{x}{n} \right)^{x} } \ge P$
